# Î£Î©Â·TOKENS.GOBERNANZA.MÃ‰TRICA.NOCODE.v2025.11
# Modo: determinista-soberano Â· 100% numÃ©rico/relacional Â· sin nombres cromÃ¡ticos ni familias tipogrÃ¡ficas

HDR:
  ENC: UTF-8
  LANG: es-MX
  MODE: determinista-soberano
  CTX: isolated
  POLICY_LOCK: ON
  STATE: "X=(Ïƒ,L,Ï„,k,r,Î¼,f,Î”x,n*,A,S)"
  RULE: "ğ•Š=1â‡”[(Ïƒ/L)â‰¤1 âˆ§ fâ‰¥f_min âˆ§ Aâ‰¥Ï„S]; act=ğ•Š?CROSS:HOLD"
  FLOW: "ingestâ†’estimateâ†’planâ†’decideâ†’act"
  CALC: "S=Î£(gÌ‚Â·Î”x); A*=Ï„S; Aâ†A+gÌ‚Â·Î”x; if Aâ‰¥A*âˆ§Â¬n* â‡’ n*=true"
  CTRL: {Ï„:"(0,1]", k:">0", Î¼:"â‰¥0", Î»:">0"}
  TELEO: "max U=Râˆ’Î»C  s.a. (Ïƒ/L)â‰¤1 âˆ§ fâ‰¥f_min âˆ§ p95(latencia)â†“"
  ARCH: "â„±âŸ³(L0..L3) self-similar; sensorsâ†’estimatorâ†’executor(idempotent)"
  AUDIT_FMT: "{S,A*,n*,ğ•Š,Ïƒ/L,f,UER,ART_p95,hash}"
  OPTIM: "âˆ‚ğ•Š/âˆ‚Î¸ via bÃºsqueda bayesiana; RLâ†’(Ï„,k); Î¼â†‘ si SNRâ†“"
  POLICY: "auto-opt; RBAC+auth+log+audit"
  CANON: "ğ•Š=[fâ‰¥f_min]âˆ§[(Ïƒ/L)â‰¤1]âˆ§[(A/S)â‰¥Ï„];  A=Î£(gÌ‚Â·Î”x)"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ CAPA BASE: unidades y ratios (adimensionales o en rem/px) â”€â”€â”€â”€â”€â”€â”€â”€â”€
base:
  unit: {rem: 1.00, px_per_rem: 16}
  scale:
    ratio_type: 1.200     # progresiÃ³n de tamaÃ±os (Ï†_t)
    ratio_space: 1.333    # progresiÃ³n de espaciado (Ï†_s)
    ratio_radius: 1.500   # progresiÃ³n de radios (Ï†_r)
    ratio_elev: 1.250     # progresiÃ³n de elevaciÃ³n (Ï†_e)
  limits:
    wcag_text: 4.5        # contraste mÃ­nimo texto normal
    wcag_large: 3.0       # contraste mÃ­nimo texto grande
    deltaE00_dup: 1.0     # umbral de duplicidad perceptual
  okLCH:
    L_targets_neutral: {0:0.99,50:0.95,100:0.90,300:0.75,600:0.45,900:0.25}
    C_neutral_max: 0.04
    C_accent_factor: 1.00        # C_accent = C_neutral_max * factor
    h_anchor_neutral: "<nÃºmero>" # Ãºnico; no publicar etiqueta
    bands_accent:
      band_1_h: "<[h_min,h_max]>"
      band_2_h: "<[h_min,h_max]>"
      band_3_h: "<[h_min,h_max]>"
      band_4_h: "<[h_min,h_max]>"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ TOKENS ESCALARES (solo magnitudes y relaciones) â”€â”€â”€â”€â”€â”€â”€â”€â”€
type_size:  # sin declarar familias; todo es derivaciÃ³n
  md_rem: 1.00
  sm_rem: "md_rem / base.scale.ratio_type"
  xs_rem: "sm_rem / base.scale.ratio_type"
  lg_rem: "md_rem * base.scale.ratio_type"
  xl_rem: "lg_rem * base.scale.ratio_type"
line_height: {body: 1.45, headings: 1.20}
tracking_em: {body: 0.00, caps: 0.02}

space_rem:
  xs: 0.25
  sm: "xs * base.scale.ratio_space"
  md: "sm * base.scale.ratio_space"
  lg: "md * base.scale.ratio_space"
  xl: "lg * base.scale.ratio_space"

radius_px:
  sm: 4
  md: "sm * base.scale.ratio_radius"
  lg: "md * base.scale.ratio_radius"

border_px: {hair: 1, strong: 2}

elev:  # offsets/blur/alpha escalan por Ï†_e (sin color)
  lv0: {z:0, dx:0,   dy:0,                 blur:0,                   spread:0, alpha:0.00}
  lv1: {z:1, dx:0,   dy:1,                 blur:2,                   spread:0, alpha:0.08}
  lv2: {z:2, dx:"lv1.dx", dy:"lv1.dy*Ï†_e", blur:"lv1.blur*Ï†_e",      spread:0, alpha:"lv1.alpha*1.10"}
  lv3: {z:3, dx:"lv2.dx", dy:"lv2.dy*Ï†_e", blur:"lv2.blur*Ï†_e",      spread:0, alpha:"lv2.alpha*1.10"}
  Ï†_e: "=base.scale.ratio_elev"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ NEUTRALES y ACENTOS (OKLCH numÃ©rico) â”€â”€â”€â”€â”€â”€â”€â”€â”€
neutral:
  levels: [0,50,100,300,600,900]
  L: "=base.okLCH.L_targets_neutral[level]"
  C_max: "=base.okLCH.C_neutral_max"
  h: "=base.okLCH.h_anchor_neutral"
accent:
  count: 4
  L_window: [0.60, 0.78]   # rango permitido
  C: "=base.okLCH.C_neutral_max * base.okLCH.C_accent_factor"
  bands_h:
    a1: "=base.okLCH.bands_accent.band_1_h"
    a2: "=base.okLCH.bands_accent.band_2_h"
    a3: "=base.okLCH.bands_accent.band_3_h"
    a4: "=base.okLCH.bands_accent.band_4_h"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTRASTE (solo cÃ¡lculo con luminancias) â”€â”€â”€â”€â”€â”€â”€â”€â”€
contrast:
  ratio: "R=(Y1+0.05)/(Y2+0.05) con Y1>Y2"
  approx_map: "usar Yâ‰ˆL_normalizada cuando no haya conversiÃ³n explÃ­cita"
  checks:
    - id: n900_on_n0
      fg_L: "=neutral.L|level=900"
      bg_L: "=neutral.L|level=0"
      min:  "=base.limits.wcag_text"
    - id: n0_on_n900
      fg_L: "=neutral.L|level=0"
      bg_L: "=neutral.L|level=900"
      min:  "=base.limits.wcag_text"
    - id: a*_on_n0_large
      fg_L: "~mean(accent.L_window)"
      bg_L: "=neutral.L|level=0"
      min:  "=base.limits.wcag_large"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ DUPLICIDAD (Î”E00) â”€â”€â”€â”€â”€â”€â”€â”€â”€
duplication:
  metric: "Î”E00"
  threshold: "=base.limits.deltaE00_dup"
  pairs:
    neutrals_adj: [[0,50],[50,100],[100,300],[300,600],[600,900]]
    accents_all:  "todas las combinaciones iâ‰ j en {1..4}"
  rule: "Î”E00(par) â‰¥ threshold"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ NOMBRES ABSTRACCIÃ“N (sin semÃ¡ntica textual) â”€â”€â”€â”€â”€â”€â”€â”€â”€
naming:
  neutral: "neutral.{level}"    # levelâˆˆ{0,50,100,300,600,900}
  accent:  "accent.{i}"         # iâˆˆ{1,2,3,4}
  tsize:   "type.size.{xs|sm|md|lg|xl}"
  space:   "space.{xs|sm|md|lg|xl}"
  radius:  "radius.{sm|md|lg}"
  elev:    "elev.{lv0|lv1|lv2|lv3}"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ EVALUADOR SOBERANO (mÃ©trico, sin cÃ³digo) â”€â”€â”€â”€â”€â”€â”€â”€â”€
evaluator:
  measures:
    f: "fitness = (#checks_ok / #checks_totales)"
    Ïƒ: "incertidumbre agregada (0..L); estimador conforme a varianza de medidas)"
    L: "cota superior operacional de Ïƒ"
    S: "potencial total = peso_contraste*1 + peso_deltaE*1 + peso_bandas*1  (mÃ¡x=1.0)"
    A: "acumulado de mejoras normalizadas = Î£(gÌ‚Â·Î”x)"
    Ï„: "<0.90..0.98>"   # recomendaciÃ³n inicial
    gÌ‚: "gradiente normalizado por regla âˆˆ[-1,1]"
    Î”x: "magnitud de ajuste por token âˆˆ[0,1]"
  weights: {contraste: 0.50, deltaE: 0.25, bandas: 0.25}
  gating:
    condition: "ğ•Š=1â‡”[(Ïƒ/L)â‰¤1 âˆ§ fâ‰¥f_min âˆ§ (A/S)â‰¥Ï„]"
    f_min: 0.92
  outputs: {S:"[0..1]", A:"[0..1]", A_star:"Ï„Â·S", pass:"ğ•Šâˆˆ{0,1}"}
  audit_emit: "{S,A*,n*,ğ•Š,Ïƒ/L,f,UER,ART_p95,hash_algo}"
  hash_algo: "BLAKE3"
  UER: "tasa de error inesperado en verificaciones (0..1)"
  ART_p95: "latencia operativa p95 (ms)"
  actions:
    if_pass:  "CROSS (congelar versiÃ³n)"
    if_hold:  "HOLD (revisar Î”x con mayor Î¼)"
  notes:
    - "Si Î”E00(neutral_adj)<threshold â‡’ incrementar |Î”x| sobre L o C (no h)."
    - "Si R_contraste<min â‡’ ajustar L (primero) antes de C."
    - "Si banda_h incumple â‡’ desplazar h dentro del intervalo asignado (sin renombrar)."

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ COMPAT (DTCG/W3C/SD) â€” especificaciÃ³n de forma (sin implementaciÃ³n) â”€â”€â”€â”€â”€â”€â”€â”€â”€
compat:
  dtcg_shape:
    type_keys: ["$type","$value"]  # valores numÃ©ricos/funcionales; sin etiquetas textuales
    paths:
      neutral: "tokens.color.neutral.{level}"
      accent:  "tokens.color.accent.{i}"
      size:    "tokens.typography.size.{k}"
      space:   "tokens.spacing.{k}"
      radius:  "tokens.radius.{k}"
      elev:    "tokens.shadow.{lv}"
  transforms_required:
    - "oklchâ†’sRGBâ†’Y (para contraste) â€” definiciÃ³n matemÃ¡tica, no ejecutable"
    - "Î”E00 (CIEDE2000) â€” definiciÃ³n mÃ©trica, no ejecutable"
    - "redondeo magnitudes: LÂ±0.005, CÂ±0.005, hÂ±1Â°"
  export_guidance:
    css_vars: "emitir magnitudes numÃ©ricas; conversiÃ³n fuera de alcance"
    mobile:   "escalar tamaÃ±os segÃºn dpi/pt; ratios se conservan"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ CRITERIOS DE ACEPTACIÃ“N (cuantificables) â”€â”€â”€â”€â”€â”€â”€â”€â”€
acceptance:
  - "Orden estricto: L(0)>L(50)>L(100)>L(300)>L(600)>L(900)"
  - "âˆ€n: C_neutral(n) â‰¤ C_neutral_max"
  - "âˆ€i: L_i âˆˆ [0.60,0.78] âˆ§ Î”E00(accent_i,accent_j)â‰¥1.0 âˆ€iâ‰ j"
  - "Contraste: R(n900/n0)â‰¥4.5 âˆ§ R(n0/n900)â‰¥4.5 âˆ§ R(a*/n0)â‰¥3.0"
  - "Escalas geomÃ©tricas respetadas: ratios Ï†_t, Ï†_s, Ï†_r, Ï†_e constantes"
  - "Evaluador: fâ‰¥0.92 âˆ§ (Ïƒ/L)â‰¤1 âˆ§ (A/S)â‰¥Ï„ â‡’ ğ•Š=1 (CROSS); si no, HOLD"

# â”€â”€â”€â”€â”€â”€â”€â”€â”€ PROMPTS (neural, solo nÃºmeros; sin nombres cromÃ¡ticos ni tipografÃ­as) â”€â”€â”€â”€â”€â”€â”€â”€â”€
prompts:
  generator:
    system: "Emite SOLO un bloque DTCG con magnitudes numÃ©ricas. No incluyas nombres semÃ¡nticos."
    user: >
      Usa targets L_neutral, C_max, h_anchor_neutral y bands_h. Deriva tamaÃ±os con ratio_type,
      espaciado con ratio_space, radios con ratio_radius y elevaciÃ³n con ratio_elev.
      Asegura checks de contraste y Î”E00 >= threshold. Devuelve neutral.{levels}, accent.{1..4},
      type.size.{xs..xl}, space.{xs..xl}, radius.{sm..lg}, elev.{lv0..lv3} como nÃºmeros y fÃ³rmulas.
  auditor:
    system: "Devuelve SOLO mÃ©tricas {f,Ïƒ/L,S,A,A*,ğ•Š} y checklist numÃ©rico."
    user: >
      Verifica orden de L, umbrales de contraste, Î”E00 y bandas_h. Calcula f con pesos,
      Sâˆˆ[0..1], A por acumulaciÃ³n de mejoras, A*=Ï„S y ğ•Š segÃºn la regla. Emite {S,A*,n*,ğ•Š,Ïƒ/L,f,UER,ART_p95,hash}.

