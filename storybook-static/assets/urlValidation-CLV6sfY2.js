const n=["http:","https:"],i=[/javascript:/i,/vbscript:/i,/file:/i,/<script/i,/on\w+=/i],l=/^[a-z0-9](?:[a-z0-9-]*[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)+$/i;function s(e){if(!e||typeof e!="string")return{isValid:!1,sanitized:null,protocol:null,reason:"Empty or invalid input"};const t=e.trim();for(const r of i)if(r.test(t))return{isValid:!1,sanitized:null,protocol:null,reason:`Suspicious pattern detected: ${r}`};let o;try{if(/^https?:\/\//i.test(t))o=new URL(t);else if(t.startsWith("//"))o=new URL(`https:${t}`);else if(l.test(t))o=new URL(`https://${t}`);else if(/^www\./i.test(t))o=new URL(`https://${t}`);else throw new Error("Invalid URL format")}catch(r){return{isValid:!1,sanitized:null,protocol:null,reason:`Parse error: ${r instanceof Error?r.message:"unknown"}`}}return n.includes(o.protocol)?o.hostname?/^(localhost|127\.0\.0\.1|0\.0\.0\.0)$/i.test(o.hostname)?{isValid:!1,sanitized:null,protocol:o.protocol,reason:"Localhost URLs are blocked in production"}:o.hostname.includes(".")?{isValid:!0,sanitized:o.href,protocol:o.protocol}:{isValid:!1,sanitized:null,protocol:o.protocol,reason:"Hostname is missing a TLD"}:{isValid:!1,sanitized:null,protocol:o.protocol,reason:"Missing hostname"}:{isValid:!1,sanitized:null,protocol:o.protocol,reason:`Protocol not allowed: ${o.protocol}`}}function c(e){const t=s(e);return t.isValid?t.sanitized:null}function d(e,t="_blank"){const o=s(e);return!o.isValid||!o.sanitized?(console.error("Blocked unsafe URL:",e,o.reason),!1):typeof window>"u"?!1:(window.open(o.sanitized,t,"noopener,noreferrer"),!0)}export{c as g,d as o};
